$(function(){var t=$("body");function e(t,e,i,n){return 3==t?e=translations.tr_melistemplatingplugincreator_field+" "+e.split("-").pop():4==t&&(e=translations.tr_melistemplatingplugincreator_field+" "+e.split("_").pop()),n+='<p class="modal-error-cont"><b title="'+e+'">'+e+": </b><br>  ",$.each(i,function(e,a){if("label"!==e){var o=null==i[e].label?null==i.label?e:i.label:i[e].label;n+='<p class="modal-error-cont"><b title="'+o+'">'+o+": </b>  ";try{3==t?$.each(a,function(t,e){"label"!==t&&$.each(e,function(t,e){"label"!==t&&(n+='<span><i class="fa fa-circle"></i>'+e+"</span>")})}):$.each(a,function(t,e){"label"!==t&&(n+='<span><i class="fa fa-circle"></i>'+e+"</span>")})}catch(t){"label"!==e&&(n+='<span><i class="fa fa-circle"></i>'+a+"</span>")}n+="</p>"}}),n}function i(t,e,i){3==t?$.each(e,function(t,e){"tpc_main_property_field_count"==t?$("form"+i+" .form-control[name='"+t+"']").parents(".form-group").find("label").css("color","red"):$.each(e,function(e,i){$("form#"+t+" .form-control[name='"+e+"']").parents(".form-group").find("label").css("color","red")})}):4==t?$.each(e,function(t,e){$.each(e,function(t,e){var i=t.split("_").pop();$.each(e,function(t,e){$.each($("#melistemplatingplugincreator_step4 form"),function(){$(this).attr("id");$(this).find("input[name=tpc_field_num]").val()==i&&$(this).find("input.form-control[name='"+t+"']").parents(".form-group").find("label").css("color","red")})})})}):$.each(e,function(t,e){$("form"+i+" .form-control[name='"+t+"']").parents(".form-group").find("label").css("color","red")})}t.on("click",".melis-templating-plugin-creator-steps-content .btn-steps",function(){var n=$(this).data("curstep"),a=$(this).data("nextstep"),o=(new Array,new FormData),l=$(".melis-templating-plugin-creator-steps-content form.templating-plugin-creator-step-"+n);$("form.templating-plugin-creator-step-"+n+" .form-control").parents(".form-group").find("label").css("color","#686868"),l.each(function(t,e){var i=$(this).closest("form").attr("name"),n=$("form[name="+i+"]").length,a=new FormData($(this)[0]).entries();for(var l of a)n>1?o.append("step-form["+t+"]["+l[0]+"]",l[1]):o.append("step-form["+l[0]+"]",l[1]);$(this).find('input[type="radio"]:not(:checked),input[type="checkbox"]:not(:checked),input[type="text"][value=""],select[value=""]').each(function(){if(n>1)var e="step-form["+t+"]["+this.name+"]";else e="step-form["+this.name+"]";o.has(e)||o.append(e,"")})}),o.append("curStep",n),o.append("nextStep",a),$(this).hasClass("tpc-validate")&&o.append("validate",!0),$.ajax({type:"POST",url:"/melis/MelisTemplatingPluginCreator/TemplatingPluginCreator/renderTemplatingPluginCreatorSteps",data:o,dataType:"json",encode:!0,cache:!1,contentType:!1,processData:!1}).done(function(a){setTimeout(function(){if(a.errors)a.errors.tpc_plugin_upload_thumbnail&&$(".plugin_thumbnail_div").length&&$(".plugin_thumbnail_div").remove(),3==n||4==n?function(i,n,a,o,l){l||(l="closeByButtonOnly");l="closeByButtonOnly"!==l?"overlay-hideonclick":"";var r="<h3>"+melisHelper.melisTranslator(n)+"</h3>";r+="<h4>"+melisHelper.melisTranslator(a)+"</h4>",$.each(o,function(t,n){if(3==i)if("tpc_main_property_field_count"==t){if("label"!==t){var a=null==o[t].label?null==o.label?t:o.label:o[t].label;r+='<p class="modal-error-cont"><b title="'+a+'">'+a+": </b>  ";try{$.each(n,function(t,e){"label"!==t&&(r+='<span><i class="fa fa-circle"></i>'+e+"</span>")})}catch(e){"label"!==t&&(r+='<span><i class="fa fa-circle"></i>'+n+"</span>")}r+="</p>"}}else r=e(i,t,n,r);else 4==i&&$.each(n,function(t,n){r=e(i,t,n,r)})});var s="<div class='melis-modaloverlay "+l+"'></div>";s+="<div class='melis-modal-cont KOnotif'>  <div class='modal-content'>"+r+" <span class='btn btn-block btn-primary'>"+translations.tr_meliscore_notification_modal_Close+"</span></div> </div>",t.append(s)}(n,a.textTitle,a.textMessage,a.errors):melisHelper.melisKoNotification(a.textTitle,a.textMessage,a.errors),i(n,a.errors,".templating-plugin-creator-step-"+n),$("#id_melistemplatingplugincreator_steps #loader").remove();else if(a.textMessage)melisHelper.melisKoNotification(a.textTitle,a.textMessage,a.errors),$("#id_melistemplatingplugincreator_steps #loader").remove();else{$("#id_melistemplatingplugincreator_steps").html(a.html),$(".melis-templating-plugin-creator-steps li").removeClass("active");var o=$("#id_melistemplatingplugincreator_steps .steps-content").attr("id");$("#tpc_"+o).addClass("active")}},500)}).fail(function(t,e,i){alert(translations.tr_meliscore_error_message)})}),t.on("change","#templating-plugin-creator-step-1 input[name='tpc_plugin_destination']",function(){"new_module"==$("input:radio[name=tpc_plugin_destination]:checked").val()?($("#tpc_new_module_name").parents(".form-group").show(),$("#tpc_existing_module_name").parents(".form-group").hide(),$("#tpc_existing_module_name option").prop("selected",!1)):($("#tpc_new_module_name").parents(".form-group").hide(),$("#tpc_new_module_name").val(""),$("#tpc_existing_module_name").parents(".form-group").show())}),t.on("click",".melis-tpc-final-content .fa",function(){$(this).hasClass("fa-check-square-o")?($(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$(this).next("input").attr("checked",!1)):($(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success"),$(this).next("input").attr("checked",!0))}),t.on("click","a[data-id=id_melistemplatingplugincreator_tool]",function(t){$.ajax({type:"POST",url:"/melis/MelisTemplatingPluginCreator/TemplatingPluginCreator/removeTempThumbnailDir",data:{},dataType:"text"}).done(function(t){}).fail(function(t,e,i){alert(translations.tr_meliscore_error_message)})}),t.on("change","#tpc_plugin_upload_thumbnail",function(t){var e=$("#id-templating-plugin-creator-thumbnail-upload-form")[0],n=new FormData(e);n.append("file",$("input[type=file]")[0].files[0]),melisCoreTool.pending(".btn-steps"),$.ajax({type:"POST",url:"/melis/MelisTemplatingPluginCreator/TemplatingPluginCreator/processUpload",data:n,dataType:"json",encode:!0,cache:!1,contentType:!1,processData:!1,async:!0,xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",templatingPluginCreatorTool.progress,!1),t}}).done(function(t){if(t.success){$("div.progressContent").addClass("hidden"),$("form#id-templating-plugin-creator-thumbnail-upload-form .form-control").parents(".form-group").find("label").css("color","#686868");var e=$("#pluginThumbnailUploadArea"),n=$(".plugin_thumbnail_div");n.length?n.empty():$('<div class="col-xs-12 col-lg-6"><div class="plugin_thumbnail_div"></div></div>').appendTo(e),$("<img />",{src:t.pluginThumbnail,class:"plugin_thumbnail"}).appendTo(".plugin_thumbnail_div"),$('<div class="hover-details"><div class="me-p-btn-cont"><a id="plugin-thumbnail-eye" class="viewImageDocument" href="" target="_blank"><i class="fa fa-eye"></i></a><a id="removePluginThumbnail" data-type="image"><i class="fa fa-times"></i></a></div></div>').appendTo(".plugin_thumbnail_div"),$("#plugin-thumbnail-eye").attr("href",t.pluginThumbnail),n.show()}else $("div.progressContent").addClass("hidden"),$(".plugin_thumbnail_div").length&&$(".plugin_thumbnail_div").remove(),melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),i(0,t.errors,".templating-plugin-creator-step-2");melisCoreTool.done(".btn-steps")}).fail(function(t,e,i){alert(translations.tr_meliscore_error_message)})}),t.on("click",".melis-templating-plugin-creator-steps-content #removePluginThumbnail",function(){melisCoreTool.pending("#removePluginThumbnail"),melisCoreTool.confirm(translations.tr_melistemplatingplugincreator_common_label_yes,translations.tr_melistemplatingplugincreator_common_label_no,translations.tr_melistemplatingplugincreator_delete_plugin_thumbnail_title,translations.tr_melistemplatingplugincreator_delete_plugin_thumbnail_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisTemplatingPluginCreator/TemplatingPluginCreator/removePluginThumbnail",data:null,dataType:"json",encode:!0}).done(function(t){t.success?($("#tpc_plugin_upload_thumbnail").val(""),$(".plugin_thumbnail_div").remove()):melisHelper.melisKoNotification(translations.tr_melistemplatingplugincreator_delete_plugin_thumbnail_title,translations.tr_melistemplatingplugincreator_delete_plugin_thumbnail_error,null),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done("#removePluginThumbnail")}),t.on("keyup",".melis-templating-plugin-creator-steps-content #tpc_main_property_field_count",function(){var t=$("#tpc_main_property_field_count").val();$("#tpc_main_property_field_count").parents(".form-group").find("label").css("color","#686868"),$("#field-form-div").empty(),$.isNumeric(t)?t>0&&t<=25?function(t,e,i){$.ajax({type:"POST",url:"/melis/MelisTemplatingPluginCreator/TemplatingPluginCreator/getFieldForm",data:{fieldCount:t,curStep:e,tab:i},dataType:"text",encode:!0}).done(function(t){$("#field-form-div").html(t),widgetCollapsibleInit()}).fail(function(){alert(translations.tr_meliscore_error_message)})}(t,$("#tpc_main_property_field_count").parents().find(".tpc-validate").data("curstep"),$("#tpc_property_tab_number").val()):melisHelper.melisKoNotification(translations.tr_melistemplatingplugincreator_title_step_3,translations.tr_melistemplatingplugincreator_value_must_be_between_1_to_25,null):melisHelper.melisKoNotification(translations.tr_melistemplatingplugincreator_title_step_3,translations.tr_melistemplatingplugincreator_integer_only,null)}),t.on("focusin",".melis-templating-plugin-creator-steps-content #tpc_field_display_type",function(){$(this).data("val",$(this).val())}).on("change",".melis-templating-plugin-creator-steps-content #tpc_field_display_type",function(){var t=$(this).data("val"),e=$(this).val(),i='<input class = "form-control" type = "text" id = "tpc_field_default_value" name = "tpc_field_default_value" value="">';if($(this).parents("form").find("#tpc_field_default_value, #tpc_field_default_options").val(""),$(this).blur(),"Dropdown"==t&&"Dropdown"!=e?($(this).parents("form").find("#tpc_field_default_options").removeAttr("data-role"),$(this).parents("form").find("#tpc_field_default_options").tagsinput("destroy"),$(this).parents("form").find("#tpc_field_default_options").parents(".form-group").hide(),$(this).parents("form").find("#tpc_field_default_value").closest(".form-group.input-group").empty().append(i)):"DatePicker"==t&&"DatePicker"!=e||"DateTimePicker"==t&&"DateTimePicker"!=e?$(this).parents("form").find("#tpc_field_default_value").datetimepicker("destroy"):"Switch"==t&&"Switch"!=e||"PageInput"==t&&"PageInput"!=e?$(this).parents("form").find("#tpc_field_default_value").closest(".form-group.input-group").empty().append(i):"MelisCoreTinyMCE"==t&&"MelisCoreTinyMCE"!=e&&$(this).parents("form").find('textarea[name="tpc_field_default_value"]').closest(".form-group.input-group").empty().append(i),"Dropdown"==e)$(this).parents("form").find("#tpc_field_default_options").parents(".form-group").show(),$(this).parents("form").find("#tpc_field_default_options").attr("data-role","tagsinput"),$(this).parents("form").find("#tpc_field_default_options").tagsinput({allowDuplicates:!1}),$(this).parents("form").find("#tpc_field_default_options").tagsinput("refresh"),$(this).parents("form").find("#tpc_field_default_value").replaceWith('<div class="col-md-2 padding-left-0"><select id="tpc_field_default_value" name="tpc_field_default_value" class="form-control"><option value="">Choose</option></select></div>');else if("DatePicker"==e)$(this).parents("form").find("#tpc_field_default_value").datetimepicker({format:"YYYY-MM-DD"});else if("DateTimePicker"==e)$(this).parents("form").find("#tpc_field_default_value").datetimepicker({format:"YYYY-MM-DD HH:mm:ss"});else if("Switch"==e)$(this).parents("form").find("#tpc_field_default_value").replaceWith('<div class="col-md-2 padding-left-0"><select id="tpc_field_default_value" name="tpc_field_default_value" class="form-control"><option value="">Choose</option><option value="1">On</option><option value="0">Off</option></select></div>');else if("PageInput"==e)$(this).parents("form").find("#tpc_field_default_value").closest(".form-group.input-group").empty().prepend('<div class="d-flex flex-row justify-content-between">'+i+'<a class="btn btn-default meliscms-site-selector"><i class="fa fa-sitemap"></i></a></div>');else if("MelisCoreTinyMCE"==e){var n=Math.round((new Date).getTime()+100*Math.random());$(this).parents("form").find("#tpc_field_default_value").replaceWith('<textarea data-tinymce-id="'+n+'" id="'+n+'" class="form-control" name="tpc_field_default_value"></textarea>'),melisTinyMCE.createTinyMCE("tool","textarea[data-tinymce-id='"+n+"']",{height:200,relative_urls:!1,remove_script_host:!1,convert_urls:!1})}}),t.on("itemAdded","#tpc_field_default_options",function(t){$(this).parents("form").find("#tpc_field_default_value").append('<option value="'+t.item+'">'+t.item+"</option>")}),t.on("itemRemoved","#tpc_field_default_options",function(t){$(this).parents("form").find("#tpc_field_default_value option[value='"+t.item+"']").remove()})});var templatingPluginCreatorTool={progress:function(t){var e=$("div.progressContent");e.removeClass("hidden");var i=$("div.progressContent > div.progress > div.progress-bar");i.attr("aria-valuenow",0).css("width","0%");var n=$("div.progressContent > div.progress > span.status");if(n.html(""),t.lengthComputable){var a=t.total,o=100*t.loaded/a;i.attr("aria-valuenow",o),i.css("width",o+"%"),o>100?e.addClass("hidden"):n.html(Math.round(o)+"%")}else alert("not computable")}},widgetCollapsibleInit=function(){$('.widget[data-toggle="collapse-widget"] .widget-body').on("show.bs.collapse",function(){$(this).parents(".widget:first").attr("data-collapse-closed","false")}).on("shown.bs.collapse",function(){setTimeout(function(){$(window).resize()},500)}).on("hidden.bs.collapse",function(){$(this).parents(".widget:first").attr("data-collapse-closed","true")}),$('.widget[data-toggle="collapse-widget"]').each(function(){$(this).find(".widget-head > .collapse-toggle").length||$('<span class="collapse-toggle"></span>').appendTo($(this).find(".widget-head")),$(this).find(".widget-body").not(".collapse").addClass("collapse"),"true"!==$(this).attr("data-collapse-closed")&&$(this).find(".widget-body").addClass("in"),$(this).find(".accordionTitle").on("click",function(){var t=$(".prices-accordion.active");$.each(t,function(){$(this).find(".widget[data-collapse-closed=false]").find(".widget-body").collapse("toggle")}),$(this).parents(".widget:first").find(".widget-body").collapse("toggle")})})};!function(t){"use strict";var e={tagClass:function(t){return"label label-info"},itemValue:function(t){return t?t.toString():t},itemText:function(t){return this.itemValue(t)},itemTitle:function(t){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!0,onTagExists:function(t,e){e.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};function i(e,i){this.itemsArray=[],this.$element=t(e),this.$element.hide(),this.isSelect="SELECT"===e.tagName,this.multiple=this.isSelect&&e.hasAttribute("multiple"),this.objectItems=i&&i.itemValue,this.placeholderText=e.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=t('<div class="bootstrap-tagsinput form-control"></div>'),this.$input=t('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(i)}function n(t,e){if("function"!=typeof t[e]){var i=t[e];t[e]=function(t){return t[i]}}}function a(t,e){if("function"!=typeof t[e]){var i=t[e];t[e]=function(){return i}}}i.prototype={constructor:i,add:function(e,i,n){var a=this;if(!(a.options.maxTags&&a.itemsArray.length>=a.options.maxTags)&&(!1===e||e)){if("string"==typeof e&&a.options.trimValue&&(e=t.trim(e)),"object"==typeof e&&!a.objectItems)throw"Can't add objects when itemValue option is not set";if(!e.toString().match(/^\s*$/)){if(a.isSelect&&!a.multiple&&a.itemsArray.length>0&&a.remove(a.itemsArray[0]),"string"==typeof e&&"INPUT"===this.$element[0].tagName){var o=a.options.delimiterRegex?a.options.delimiterRegex:a.options.delimiter,r=e.split(o);if(r.length>1){for(var s=0;s<r.length;s++)this.add(r[s],!0);return void(i||a.pushVal())}}var p=a.options.itemValue(e),c=a.options.itemText(e),u=a.options.tagClass(e),d=a.options.itemTitle(e),m=t.grep(a.itemsArray,function(t){return a.options.itemValue(t)===p})[0];if(!m||a.options.allowDuplicates){if(!(a.items().toString().length+e.length+1>a.options.maxInputLength)){var f=t.Event("beforeItemAdd",{item:e,cancel:!1,options:n});if(a.$element.trigger(f),!f.cancel){a.itemsArray.push(e);var h=t('<span class="tag '+l(u)+(null!==d?'" title="'+d:"")+'">'+l(c)+'<span data-role="remove"></span></span>');if(h.data("item",e),a.findInputWrapper().before(h),h.after(" "),a.isSelect&&!t('option[value="'+encodeURIComponent(p)+'"]',a.$element)[0]){var g=t("<option selected>"+l(c)+"</option>");g.data("item",e),g.attr("value",p),a.$element.append(g)}i||a.pushVal(),a.options.maxTags!==a.itemsArray.length&&a.items().toString().length!==a.options.maxInputLength||a.$container.addClass("bootstrap-tagsinput-max"),a.$element.trigger(t.Event("itemAdded",{item:e,options:n}))}}}else if(a.options.onTagExists){var _=t(".tag",a.$container).filter(function(){return t(this).data("item")===m});a.options.onTagExists(e,_)}}}},remove:function(e,i,n){var a=this;if(a.objectItems&&(e=(e="object"==typeof e?t.grep(a.itemsArray,function(t){return a.options.itemValue(t)==a.options.itemValue(e)}):t.grep(a.itemsArray,function(t){return a.options.itemValue(t)==e}))[e.length-1]),e){var o=t.Event("beforeItemRemove",{item:e,cancel:!1,options:n});if(a.$element.trigger(o),o.cancel)return;t(".tag",a.$container).filter(function(){return t(this).data("item")===e}).remove(),t("option",a.$element).filter(function(){return t(this).data("item")===e}).remove(),-1!==t.inArray(e,a.itemsArray)&&a.itemsArray.splice(t.inArray(e,a.itemsArray),1)}i||a.pushVal(),a.options.maxTags>a.itemsArray.length&&a.$container.removeClass("bootstrap-tagsinput-max"),a.$element.trigger(t.Event("itemRemoved",{item:e,options:n}))},removeAll:function(){for(t(".tag",this.$container).remove(),t("option",this.$element).remove();this.itemsArray.length>0;)this.itemsArray.pop();this.pushVal()},refresh:function(){var e=this;t(".tag",e.$container).each(function(){var i=t(this),n=i.data("item"),a=e.options.itemValue(n),o=e.options.itemText(n),r=e.options.tagClass(n);(i.attr("class",null),i.addClass("tag "+l(r)),i.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=l(o),e.isSelect)&&t("option",e.$element).filter(function(){return t(this).data("item")===n}).attr("value",a)})},items:function(){return this.itemsArray},pushVal:function(){var e=this,i=t.map(e.items(),function(t){return e.options.itemValue(t).toString()});e.$element.val(i,!0).trigger("change")},build:function(i){var o=this;if(o.options=t.extend({},e,i),o.objectItems&&(o.options.freeInput=!1),n(o.options,"itemValue"),n(o.options,"itemText"),a(o.options,"tagClass"),o.options.typeahead){var l=o.options.typeahead||{};a(l,"source"),o.$input.typeahead(t.extend({},l,{source:function(e,i){function n(t){for(var e=[],n=0;n<t.length;n++){var l=o.options.itemText(t[n]);a[l]=t[n],e.push(l)}i(e)}this.map={};var a=this.map,r=l.source(e);t.isFunction(r.success)?r.success(n):t.isFunction(r.then)?r.then(n):t.when(r).then(n)},updater:function(t){return o.add(this.map[t]),this.map[t]},matcher:function(t){return-1!==t.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(t){return t.sort()},highlighter:function(t){var e=new RegExp("("+this.query+")","gi");return t.replace(e,"<strong>$1</strong>")}}))}if(o.options.typeaheadjs){var s=null,p={},c=o.options.typeaheadjs;t.isArray(c)?(s=c[0],p=c[1]):p=c,o.$input.typeahead(s,p).on("typeahead:selected",t.proxy(function(t,e){p.valueKey?o.add(e[p.valueKey]):o.add(e),o.$input.typeahead("val","")},o))}o.$container.on("click",t.proxy(function(t){o.$element.attr("disabled")||o.$input.removeAttr("disabled"),o.$input.focus()},o)),o.options.addOnBlur&&o.options.freeInput&&o.$input.on("focusout",t.proxy(function(e){0===t(".typeahead, .twitter-typeahead",o.$container).length&&(o.add(o.$input.val()),o.$input.val(""))},o)),o.$container.on("keydown","input",t.proxy(function(e){var i=t(e.target),n=o.findInputWrapper();if(o.$element.attr("disabled"))o.$input.attr("disabled","disabled");else{switch(e.which){case 8:if(0===r(i[0])){var a=n.prev();a.length&&o.remove(a.data("item"))}break;case 46:if(0===r(i[0])){var l=n.next();l.length&&o.remove(l.data("item"))}break;case 37:var s=n.prev();0===i.val().length&&s[0]&&(s.before(n),i.focus());break;case 39:var p=n.next();0===i.val().length&&p[0]&&(p.after(n),i.focus())}var c=i.val().length;Math.ceil(c/5);i.attr("size",Math.max(this.inputSize,i.val().length))}},o)),o.$container.on("keypress","input",t.proxy(function(e){var i=t(e.target);if(o.$element.attr("disabled"))o.$input.attr("disabled","disabled");else{var n,a,l,r=i.val(),s=o.options.maxChars&&r.length>=o.options.maxChars;o.options.freeInput&&(n=e,a=o.options.confirmKeys,l=!1,t.each(a,function(t,e){if("number"==typeof e&&n.which===e)return l=!0,!1;if(n.which===e.which){var i=!e.hasOwnProperty("altKey")||n.altKey===e.altKey,a=!e.hasOwnProperty("shiftKey")||n.shiftKey===e.shiftKey,o=!e.hasOwnProperty("ctrlKey")||n.ctrlKey===e.ctrlKey;if(i&&a&&o)return l=!0,!1}}),l||s)&&(0!==r.length&&(o.add(s?r.substr(0,o.options.maxChars):r),i.val("")),!1===o.options.cancelConfirmKeysOnEmpty&&e.preventDefault());var p=i.val().length;Math.ceil(p/5);i.attr("size",Math.max(this.inputSize,i.val().length))}},o)),o.$container.on("click","[data-role=remove]",t.proxy(function(e){o.$element.attr("disabled")||o.remove(t(e.target).closest(".tag").data("item"))},o)),o.options.itemValue===e.itemValue&&("INPUT"===o.$element[0].tagName?o.add(o.$element.val()):t("option",o.$element).each(function(){o.add(t(this).attr("value"),!0)}))},destroy:function(){this.$container.off("keypress","input"),this.$container.off("click","[role=remove]"),this.$container.remove(),this.$element.removeData("tagsinput"),this.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var e=this.$input[0],i=this.$container[0];e&&e.parentNode!==i;)e=e.parentNode;return t(e)}},t.fn.tagsinput=function(e,n,a){var o=[];return this.each(function(){var l=t(this).data("tagsinput");if(l)if(e||n){if(void 0!==l[e]){if(3===l[e].length&&void 0!==a)var r=l[e](n,null,a);else r=l[e](n);void 0!==r&&o.push(r)}}else o.push(l);else l=new i(this,e),t(this).data("tagsinput",l),o.push(l),"SELECT"===this.tagName&&t("option",t(this)).attr("selected","selected"),t(this).val(t(this).val())}),"string"==typeof e?o.length>1?o:o[0]:o},t.fn.tagsinput.Constructor=i;var o=t("<div />");function l(t){return t?o.text(t).html():""}function r(t){var e=0;if(document.selection){t.focus();var i=document.selection.createRange();i.moveStart("character",-t.value.length),e=i.text.length}else(t.selectionStart||"0"==t.selectionStart)&&(e=t.selectionStart);return e}t(function(){t("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);
